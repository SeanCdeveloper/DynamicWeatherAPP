<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Dynamic Weather App</title>
    <!--
    <script src="./Assets/JavaScript/script.js"></script>
    -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <style>
        /* Input Element Modification: Begin */

        /* Main Input Element */

        #cityQuery {
            background: white;
        }

       /* Button for Adding A New City to Dynamic List */

        #addCitybtn {
            background: skyblue;
        }

        #search {
            background: blue;
        }

        #buttons-view {
            background: green;
        }

        aside {
            background: red;
        }

        #formLWrap {
            background: #d3d3d3;
        }

        /* Dynamic Btn Object, Displaying Weather, Below */
        .newCity {
            display: block;
            width: 100%;
            margin: 2% 0 0 0;
        }

        /* Input Elements: End */

        /* Weather Display Elements */
        .todaysWeatherBlock {
            background: gold;
        }

        /*
        .fiveDayWrapper { 
            margin: 11em 0 0 0;
            background: red;
        }        
*/

        /* Five-Day Forecast Elements */
        .five_day_div {
            background: blue;
            width: 18%;
            color: white;
            display: inline-block;
            margin: 0 1% 1% 1%;
        }

        /* Five-Day Forecast Wrapper */
        #showWeatherForecast {
            margin: 2em 0 0 0;
            background: #d3d3d3;
        }
    </style>
</head>
<body>
    <!--Code for City Search-->
    <div class="container">
        <div>
            <h1 style="text-align: center">Weather Dashboard</h1>
        </div>
        <div class="row">
            <div id="formLWrap" class="col-4">
                <aside>
                    <form id="Search">
                        <!--Input Field To Search for New Cities-->
                        <label for="cityQuery">Search For A City:</label><br>
                        <input type="text" id="cityQuery" />
                        <!--Button type="submit" to trigger new movie addition-->
                        <input id="addCitybtn" type="submit" value="Add A City" />
                        <!--<button class="btn saveBtn col-md-1"><i class="fas fa-save"></i></button>-->
                    </form>
                    <!--Element For Dynamic Buttons-->
                    <div id="buttons-view"></div>
                </aside>
            </div>
            <div class="col-8">
                <div class="todaysWeatherBlock">
                    <h2 class="city"></h2>
                    <div id="icon"><img class="wIcon" src=""></div>
                    <div class="temp"></div>
                    <div class="weatherDescription"></div>
                    <div class="humidity"></div>
                    <div class="wind"></div>
                    <div class="uvIndex"></div>
                    <div class="fiveDayWrapper">
                        <div id="showWeatherForecast"></div>
                    </div>
                </div>
            </div>
        </div>
        <!--
        <div class="row">
            <div class="col-4"></div>
            <div class="col-8">
                <div class="fiveDayWrapper">
                    <div id="showWeatherForecast"></div>
                </div>
            </div>
        </div>
    </div>
-->
        <!--Elements for Today's-Weather Block-->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
        <script type="text/javascript">

            // Initial Array of Cities
            var cities = [];

            function displayCityInfo() {

                var searchedCity = $(this).attr("data-name");

                var domainName = "https://api.openweathermap.org/data/2.5/";
                var APIkey = "bbb815e9d5d661bba4a9ff4878159a9b";
                var lat = 39.95;
                var lon = -75.1;
                var weatherURL = domainName + "weather?q=" + searchedCity + "&appid=" + APIkey;
                var uviURL = domainName + "uvi?lat=" + lat + "&lon=" + lon + "6&appid=" + APIkey;

                /* var uviURL = domainName + "uvi?lat=" + lat + "lon=" + lon + "6&appid=" + APIkey;*/
                /* lat=39.95&lon=-75.1 */
                var fiveDayURL = domainName + "forecast?q=" + searchedCity + "&appid=" + APIkey;

                $.ajax({
                    url: weatherURL,
                    method: "GET"
                }).then(function (response) {
                    console.log(response);
                    var lat = (response["coord"].lat);
                    var lon = (response["coord"].lon);
                    console.log(lat); // displays "39.95"
                    console.log(lon); // displays "-75.16".
                    /* I want "var lat" and "var lon" to be dynamically added to the uvi    
                    search and change based on "var searchedCity"
                    ## "var searchedCity = $(this).attr("data-name");
                     */
                    $(".city").text(response.name + " (" + moment().format("L") + ")");
                    var imgCode = response.weather[0].icon;
                    var imageURL = "http://openweathermap.org/img/w/" + imgCode + ".png";
                    $(".wIcon").attr("src", imageURL);
                    var Kelvin = response.main.temp;
                    var Farenheit = Math.floor((Kelvin - 273.15) * 1.80 + 32);
                    $(".temp").text("Temperature: " + Farenheit + " ËšF");
                    $(".weatherDescription").text(response.weather[0].description);
                    $(".wind").text("Wind Speed: " + response.wind.speed + " MPH");
                    $(".humidity").text("Humidity: " + response.main.humidity + "%");

                    $.ajax({
                        url: uviURL,
                        method: "GET",
                    }).then(function (response) {
                        console.log(response);
                        console.log(lat);
                        console.log(lon);
                        var uviDisp = response.value;
                        $(".uvIndex").text("UV Index: " + uviDisp);
                    });
                });
                /*
                            $.ajax({
                                url: uviURL,
                                method: "GET"
                            }).then(function (response) {
                                console.log(response);
                                var uviDisp = response.value;
                                $(".uvIndex").text("UV Index: " + uviDisp);
                            });
                */

                $.ajax({
                    url: fiveDayURL,
                    method: "GET",
                    data: {
                        cnt: "5"
                    }
                }).then(function (response) {
                    var wf = "";
                    var d0 = moment().add(1, 'days').format("L");
                    var d1 = moment().add(2, 'days').format("L");
                    var d2 = moment().add(3, 'days').format("L");
                    var d3 = moment().add(4, 'days').format("L");
                    var d4 = moment().add(5, 'days').format("L");

                    var momentArr = [d0, d1, d2, d3, d4];

                    wf += "<h2>" + response.city.name + " Five-Day Forecast" + "</h2>";
                    $.each(response.list, function (index, val) {
                        wf += "<div class='five_day_div'"; // Opening paragraph tag
                        wf += "<span>" + momentArr[index] + "</span>";
                        wf += "<img src='https://openweathermap.org/img/w/" + val.weather[0].icon + ".png'>"; // Icon
                        var Kelvin = val.main.temp;
                        var Farenheit = Math.floor((Kelvin - 273.15) * 1.80 + 32);
                        wf += "Temp: " + Farenheit + "&degF"; // Temperature
                        wf += "<span> | " + val.weather[0].description + "</span>";
                        wf += "<span> | Humidity: " + val.main.humidity + "% </span>";
                        wf += "</div>"; // Closing paragraph Tag
                        // Fix to showFiveDay
                        $("#showWeatherForecast").html(wf);
                    });
                });
            }

            $("#addCitybtn").on("click", function () {
                event.preventDefault();
                var searchedCity = $("#cityQuery").val().trim();
                cities.push(searchedCity);
                renderButtons();
            });

            function renderButtons() {
                $("#buttons-view").empty();
                for (var i = 0; i < cities.length; i++) {
                    var a = $("<button>");
                    a.addClass("newCity");
                    a.attr("data-name", cities[i]);
                    a.text(cities[i]);
                    $("#buttons-view").append(a);
                }
            }
            $(document).on("click", ".newCity", displayCityInfo);
        </script>
</body>

</html>