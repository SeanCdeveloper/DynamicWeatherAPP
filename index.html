<!--Starter Code with Icon and UV Index included with other Weather Argumentss-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Dynamic Weather APP</title>
    <!--
    <script src="./Assets/JavaScript/script.js"></script>
    -->
</head>
<body>
    <!--Code for City Search-->
    <div class="container">
        <div><h1 style="text-align: center">Weather Dashboard</h1></div>
        <form id="Search">
            <!--Input Field To Search for New Cities-->
            <label for="cityQuery">Search For a City:</label><br>
            <input type="text" id="cityQuery"/>
            <!--Button type="submit" to trigger new movie addition-->
            <input id="addCitybtn" type="submit" value="Add A City"/>
        </form>
        <div id="buttons-view"></div>
         <!--Element To Prepend Cities Searched To-->
        <div id="city-view"></div>
        <div id="showWeatherForecast"></div>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script type="text/javascript">
        // Initial Array of Cities
        var cities = []; 

        function displayCityInfo() {

        var searchedCity = $(this).attr("data-name");
        var APIkey = "bbb815e9d5d661bba4a9ff4878159a9b";
        var weatherURL = "https://api.openweathermap.org/data/2.5/weather?q=" + searchedCity + "&appid=" + APIkey;
        var uviURL = "https://api.openweathermap.org/data/2.5/uvi?lat=39.95&lon=-75.16&appid=" + APIkey;
        var fiveDayURL = "https://api.openweathermap.org/data/2.5/forecast?q=" + searchedCity + "&appid=" + APIkey;

        $.ajax({
            url: weatherURL,
            method: "GET"
        }).then(function (response) {
            console.log(weatherURL);
            console.log(response);
            console.log(response.wind.speed);
            console.log(response.weather[0].icon);
            var cityDiv = $("<div class='cityDiv'>")
            var cityCntryDisp = response.name + ", " + response.sys.country;
            var pOne = $("<p>").text(cityCntryDisp + " (" + moment().format("L") + ")");
            cityDiv.append(pOne);
            var tempDisp = response.main.temp;
            var pTwo = $("<p>").text("Temperature: " + tempDisp)
            cityDiv.append(pTwo);
            var humidityDisp = response.main.humidity;
            var pThree = $("<p>").text("Humidity: " + humidityDisp);
            cityDiv.append(pThree);
            var windDisp = response.wind.speed;
            var pFour = $("<p>").text("Wind Speed: " + windDisp);
            cityDiv.append(pFour);
            var imgCode = response.weather[0].icon;
            var imageURL = "http://openweathermap.org/img/w/" + imgCode + ".png";
            var imageDisp = $("<img>").attr("src", imageURL);
            cityDiv.append(imageDisp);
            $("#city-view").prepend(cityDiv);
           
/*
            var Kelvin = response.main.temp;
            var Farenheit = Math.floor((Kelvin - 273.15) * 1.80 + 32);
           // $(".temp").text(Kelvin + " Kelvin | " + " Farenheit = " + Farenheit + " Farenheit");
*/
        });
        
        $.ajax({
            url: uviURL,
            method: "GET"
        }).then(function(response) {
            console.log(response);
            var cityDiv = $("<div class='cityDiv'>")
            var uviDisp = response.value;
            var pFive = $("<p>").text("UV Index: "
             + uviDisp);
            cityDiv.append(pFive);
            console.log(pFive);
            //$(".uvIndex").html("<b>UV Index:  </b>" + response.value);
        });

        $.ajax({
        url: fiveDayURL,
        method: "GET",
        data: {
            cnt: "5"
        }
    }).then(function(response){
        console.log(response);
        var wf = "";
        wf += "<h2>" + response.city.name + "</h2>";
        $.each(response.list, function(index, val) {
            wf += "<p>"; // Opening paragraph tag
            wf += moment().format("L"); // Day <b>Day " + index + "</b>: | $("#currentDay").text(moment().format("LLLL"));
            wf += "<img src='https://openweathermap.org/img/w/" + val.weather[0].icon + ".png'>"; // Icon
            wf += val.main.temp + "&degC"; // Temperature
            wf += "<span> | " + val.weather[0].description + "</span>"; 
            wf += "<span> | Humidity: " + val.main.humidity + "% </span>";           
            wf += "</p>"; // Closing paragraph Tag
            $("#showWeatherForecast").html(wf);
        });
    });

        }
        $("#addCitybtn").on("click", function () {
            event.preventDefault();
            console.log(event.target);
            var searchedCity = $("#cityQuery").val().trim();
            console.log(searchedCity);
            cities.push(searchedCity);
            console.log(cities);
            renderButtons();
        });

        function renderButtons() {
            $("#buttons-view").empty();
            for (var i = 0; i < cities.length; i++) {
                var a = $("<button>");
                a.addClass("newCity");
                a.attr("data-name", cities[i]);
                a.text(cities[i]);
                $("#buttons-view").append(a);
            }
        }
        $(document).on("click", ".newCity", displayCityInfo);
    </script>
</body>
</html>